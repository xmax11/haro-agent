name: HARO Agent

on:
  schedule:
    # --- Morning Window (PKT 4 PM → 6 PM) ---
    - cron: "0,15,30,45 11 * * 1-5"
    - cron: "0,15,30,45 12 * * 1-5"
    - cron: "0,15,30,45 13 * * 1-5"

    # --- Evening Window (PKT 9 PM → 11 PM) ---
    - cron: "0,15,30,45 16 * * 1-5"
    - cron: "0,15,30,45 17 * * 1-5"
    - cron: "0,15,30,45 18 * * 1-5"

    # --- Night Window (PKT 1 AM → 3 AM) ---
    - cron: "0,15,30,45 20 * * 1-5"
    - cron: "0,15,30,45 21 * * 1-5"
    - cron: "0,15,30,45 22 * * 1-5"

  workflow_dispatch: {}  # allow manual run

jobs:
  run-haro-agent:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run HARO agent
        env:
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_CLIENT_ID: ${{ secrets.GMAIL_CLIENT_ID }}
          GMAIL_CLIENT_SECRET: ${{ secrets.GMAIL_CLIENT_SECRET }}
          GMAIL_REFRESH_TOKEN: ${{ secrets.GMAIL_REFRESH_TOKEN }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          SHEETS_CREDENTIALS: ${{ secrets.SHEETS_CREDENTIALS }}
        run: python main.py
