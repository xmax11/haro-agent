name: HARO Agent

on:
  schedule:
    # --- Window 1: PKT 2 PM → 5 PM (UTC 9 AM → 12 PM) ---
    # Runs every 15 minutes: 09:00, 09:15, 09:30, 09:45, 10:00, 10:15, 10:30, 10:45, 11:00, 11:15, 11:30, 11:45 UTC
    - cron: "0,15,30,45 9 * * 1-5"
    - cron: "0,15,30,45 10 * * 1-5"
    - cron: "0,15,30,45 11 * * 1-5"

    # --- Window 2: PKT 9 PM → 11 PM (UTC 4 PM → 6 PM) ---
    # Runs every 15 minutes: 16:00, 16:15, 16:30, 16:45, 17:00, 17:15, 17:30, 17:45, 18:00, 18:15, 18:30, 18:45 UTC
    - cron: "0,15,30,45 16 * * 1-5"
    - cron: "0,15,30,45 17 * * 1-5"
    - cron: "0,15,30,45 18 * * 1-5"

    # --- Window 3: PKT 2 AM → 5 AM (UTC 9 PM → 12 AM previous day) ---
    # Runs every 15 minutes: 21:00, 21:15, 21:30, 21:45, 22:00, 22:15, 22:30, 22:45, 23:00, 23:15, 23:30, 23:45 UTC
    # Note: Hour 0 (midnight) would be 5 AM PKT, but since window ends at 5 AM, we only need hours 21-23
    - cron: "0,15,30,45 21 * * 1-5"
    - cron: "0,15,30,45 22 * * 1-5"
    - cron: "0,15,30,45 23 * * 1-5"

  workflow_dispatch: {}  # allow manual run

jobs:
  run-haro-agent:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run HARO agent
        env:
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_CLIENT_ID: ${{ secrets.GMAIL_CLIENT_ID }}
          GMAIL_CLIENT_SECRET: ${{ secrets.GMAIL_CLIENT_SECRET }}
          GMAIL_REFRESH_TOKEN: ${{ secrets.GMAIL_REFRESH_TOKEN }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          SHEETS_CREDENTIALS: ${{ secrets.SHEETS_CREDENTIALS }}
        run: python main.py
